<Window x:Class="VMHud.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VMHud.App"
        mc:Ignorable="d"
        Title="VMHud"
        Icon="pack://siteoforigin:,,,/assets/icon.ico"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        SizeToContent="WidthAndHeight"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True"
        PreviewMouseLeftButtonDown="Window_PreviewMouseLeftButtonDown"
        PreviewMouseMove="Window_PreviewMouseMove"
        PreviewMouseLeftButtonUp="Window_PreviewMouseLeftButtonUp">
    <Window.Resources>
        <local:BooleanToBrushConverter x:Key="BoolToBrush" />
        <local:StatusToBrushConverter x:Key="StatusToBrush" />
        <local:IndexToVisibilityConverter x:Key="IndexToVisibility" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <!-- Modern dB Slider Style with value label inside the thumb (implicit style applies to all sliders) -->
        <Style TargetType="Slider">
            <Setter Property="AutoToolTipPlacement" Value="Top"/>
            <Setter Property="AutoToolTipPrecision" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid SnapsToDevicePixels="True">
                            <Rectangle Fill="#66FFFFFF" RadiusX="2" RadiusY="2" Height="4" VerticalAlignment="Center"/>
                            <Track x:Name="PART_Track">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="Slider.DecreaseLarge" Style="{x:Null}" Background="Transparent"/>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="Slider.IncreaseLarge" Style="{x:Null}" Background="Transparent"/>
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Width="24" Height="24">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Grid>
                                                    <Ellipse Fill="#FF3DD38E"/>
                                                    <TextBlock Text="{Binding Value, RelativeSource={RelativeSource AncestorType=Slider}, StringFormat={}{0:F1}}"
                                                               Foreground="White" FontSize="9" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CellBorderStyle" TargetType="Border">
            <Setter Property="Opacity" Value="1"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="True">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.7" Duration="0:0:0.10" AutoReverse="True"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                </DataTrigger>
                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="False">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.7" Duration="0:0:0.10" AutoReverse="True"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Border x:Name="RootBorder" CornerRadius="6" Background="{DynamicResource OverlayBackgroundBrush}" Padding="10" BorderThickness="1" BorderBrush="{DynamicResource OverlayBorderBrush}">
        <DockPanel>
            <Grid x:Name="HeaderBar" DockPanel.Dock="Top" Margin="0,0,0,8" MouseLeftButtonDown="HeaderBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="1" Text="{Binding StatusText}"
                           Foreground="{Binding Status, Converter={StaticResource StatusToBrush}}"
                           FontSize="12" FontWeight="SemiBold"/>
            </Grid>
            <ItemsControl ItemsSource="{Binding Strips}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="6,0" Padding="4">
                            <StackPanel>
                                <TextBlock Text="{Binding Name}" FontSize="12" HorizontalAlignment="Center" Margin="0,0,0,6">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#CCFFFFFF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPhysical}" Value="True">
                                                    <Setter Property="Foreground" Value="{DynamicResource HardwareNameBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsPhysical}" Value="False">
                                                    <Setter Property="Foreground" Value="{DynamicResource VirtualNameBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <UniformGrid Rows="8" Columns="1">
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=0}"
                                            Background="{Binding A1, Converter={StaticResource BoolToBrush}, ConverterParameter=A}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding A1}" Uid="0" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[0], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=1}"
                                            Background="{Binding A2, Converter={StaticResource BoolToBrush}, ConverterParameter=A}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding A2}" Uid="1" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[1], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=2}"
                                            Background="{Binding A3, Converter={StaticResource BoolToBrush}, ConverterParameter=A}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding A3}" Uid="2" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[2], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=3}"
                                            Background="{Binding A4, Converter={StaticResource BoolToBrush}, ConverterParameter=A}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding A4}" Uid="3" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[3], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=4}"
                                            Background="{Binding A5, Converter={StaticResource BoolToBrush}, ConverterParameter=A}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding A5}" Uid="4" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[4], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=5}"
                                            Background="{Binding B1, Converter={StaticResource BoolToBrush}, ConverterParameter=B}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding B1}" Uid="5" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[5], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=6}"
                                            Background="{Binding B2, Converter={StaticResource BoolToBrush}, ConverterParameter=B}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding B2}" Uid="6" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[6], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                    <Border Margin="1" CornerRadius="3" MinWidth="40" MinHeight="22"
                                            Visibility="{Binding DataContext.BusNames.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource IndexToVisibility}, ConverterParameter=7}"
                                            Background="{Binding B3, Converter={StaticResource BoolToBrush}, ConverterParameter=B}"
                                            Style="{StaticResource CellBorderStyle}" Tag="{Binding B3}" Uid="7" MouseLeftButtonUp="Tile_MouseLeftButtonUp">
                                        <TextBlock Text="{Binding DataContext.BusNames[7], RelativeSource={RelativeSource AncestorType=Window}}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" FontSize="11"/>
                                    </Border>
                                </UniformGrid>
                                <!-- Input volume slider -->
                                <Slider Minimum="-60" Maximum="12" SmallChange="0.1" LargeChange="3" TickFrequency="6" IsSnapToTickEnabled="False" IsMoveToPointEnabled="True"
                                        Margin="0,6,0,0" Value="{Binding Volume, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        Visibility="{Binding DataContext.ShowVolumes, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibility}}"
                                        ValueChanged="StripVolumeSlider_ValueChanged"
                                        PreviewMouseLeftButtonDown="StripVolumeSlider_PreviewMouseLeftButtonDown"
                                        PreviewMouseLeftButtonUp="StripVolumeSlider_DragCompleted"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <!-- Bus volume sliders on the right side -->
            <DockPanel DockPanel.Dock="Right" LastChildFill="False" Visibility="{Binding ShowVolumes, Converter={StaticResource BoolToVisibility}}">
                <ItemsControl ItemsSource="{Binding Buses}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="8,2">
                                <TextBlock Text="{Binding Name}" Foreground="#CCFFFFFF" Width="64"/>
                                <Slider Minimum="-60" Maximum="12" SmallChange="0.1" LargeChange="3" TickFrequency="6" Width="160" IsMoveToPointEnabled="True"
                                        Value="{Binding Gain, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        ValueChanged="BusVolumeSlider_ValueChanged"
                                        PreviewMouseLeftButtonDown="BusVolumeSlider_PreviewMouseLeftButtonDown"
                                        PreviewMouseLeftButtonUp="BusVolumeSlider_DragCompleted"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </DockPanel>
        </DockPanel>
    </Border>
</Window>
